<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <meta name='generator' content=
  'HTML Tidy for Linux/x86 (vers 7 December 2008), see www.w3.org' />
  <meta content='text/html; charset=us-ascii' http-equiv='Content-Type' />
  <meta name='description' content='Home Page for the Piccolo2D project.' />
  <meta name='format' content='text/html' />
  <meta name='keywords' content=
  'piccolo2d, piccolo2d.net, piccolo, piccolo.net, zoomable, zui, user interfaces, human-computer interaction, HCI, visualization, education' />
  <meta name='relation' content='(contained in)=http://www.piccolo2d.org' />

  <title>Piccolo2D.Java - Defining User Interaction</title>
  <link href='../piccolo2d.css' rel='stylesheet' type='text/css' />
</head>

<body>
  <div id='navigation'>
    <!-- 
this navigation node is auto-generated and injected
by the script tools/inject_navigation.rb

DO NOT EDIT IT MANUALLY!!!      
-->

    <p class='header'><a href='../index.html'><img src='../images/Piccolo2D-Logo-small.png' alt=
    'Piccolo2D Logo' /></a></p>

    <ul>
      <li>
        <a href='../index.html'>Piccolo2D&nbsp;Home</a>

        <ul>
          <li><a href='../play/index.html'>Play</a></li>

          <li>
            <a href='../learn/index.html'>Learn</a>

            <ul>
              <li><a href='../learn/about.html'>About&nbsp;Piccolo2D</a></li>

              <li><a href='../learn/patterns.html'>Piccolo2D&nbsp;Patterns</a></li>

              <li>
                <a href='../learn/get-started.html'>Getting&nbsp;Started</a>

                <ul>
                  <li><a href=
                  '../learn/out-of-box-java.html'>Java:&nbsp;Out&nbsp;of&nbsp;the&nbsp;Box</a></li>

                  <li><a href=
                  '../learn/out-of-box-dotnet.html'>.Net:&nbsp;Out&nbsp;of&nbsp;the&nbsp;Box</a></li>

                  <li><a href='../learn/interface.html'>The&nbsp;Interface</a></li>

                  <li><a href='../learn/interaction.html' class=
                  'selected'>User&nbsp;Interaction</a></li>

                  <li><a href='../learn/effects.html'>Special&nbsp;Effects</a></li>

                  <li><a href='../learn/fisheye.html'>Fisheye&nbsp;Calendar</a></li>

                  <li><a href='../learn/grapheditor.html'>Graph&nbsp;Editor</a></li>
                </ul>
              </li>

              <li><a href='../learn/api.html'>API&nbsp;Documentation</a></li>

              <li><a href='../learn/comparison.html'>Piccolo2D&nbsp;in&nbsp;Comparison</a></li>

              <li><a href='../learn/publications.html'>Publications</a></li>

              <li><a href='../learn/dev-faq.html'>Developer&nbsp;FAQ</a></li>

              <li><a href='../learn/graphics.html'>Graphics&nbsp;Primer</a></li>
            </ul>
          </li>

          <li><a href='../download.html'>Download</a></li>

          <li><a href='../community.html'>Community</a></li>

          <li><a href='../applications/index.html'>Applications</a></li>

          <li><a href='../press.html'>Press</a></li>

          <li><a href='../sponsors.html'>Sponsors</a></li>
        </ul>
      </li>
    </ul><!--
<p>
        <img src='../images/giny-small.png' alt='a nice graph' />
</p>
-->

    <p class='bugreport'><a href=
    'http://code.google.com/p/piccolo2d/issues/entry?template=User%20defect%20report'>Found a
    Typo?</a></p>

    <p class='validators'><a href='http://validator.w3.org/check/referer'><img src=
    'http://www.w3.org/Icons/valid-xhtml10-blue' alt='Valid XHTML 1.0!' style=
    'border:0;width:88px;height:31px' /></a> <a href=
    'http://jigsaw.w3.org/css-validator/check/referer'><img src=
    'http://www.w3.org/Icons/valid-css-blue' alt='Valid CSS1!' style=
    'border:0;width:88px;height:31px' /></a></p>
  </div>

  <div id='main'>
    <div id='main-head'>
      <h1>Getting Started</h1>Here you will find both basic and advanced tutorials to help you get
      started using Piccolo2D.&nbsp; All tutorials provide examples in both Java and C#.&nbsp; This
      section assumes you have read <a href='patterns.html'>Piccolo2D Patterns</a> and have a basic
      understanding of the concepts presented there.
    </div>

    <p class='toggle' id='language' style=
    'float: right; width: 8.5em; height: 8ex; border:thin solid blue;'>Show examples in<br />
    <img src='images/check.png' id='java0' alt='Checkmark' style=
    'border:0;width:1.0em;height:2ex' /> <a href='javascript:void(0);' name='jlink0' class=
    'toggle selected' id='jlink0' onmousedown=
    'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a><br />

    <img src='images/check.png' id='csharp0' alt='Checkmark' style=
    'visibility: hidden;border:0;width:1.0em;height:2ex' /> <a href='javascript:void(0);' name=
    'clink0' id='clink0' onmousedown=
    'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

    <h1>Defining User Interaction</h1>

    <p class='preamble'>This tutorial will show you how to design the set of event handlers that
    will define the user experience.&nbsp; It will cover how to add mouse and keyboard event
    handlers to the main camera and other nodes, as well as how to filter and consume events.</p>

    <p class='image'><img src='images/interaction.jpg' alt='user interaction' /><br />
    Download the complete code sample in <a href=
    'http://piccolo2d.googlecode.com/files/codesample.java-1.2-userinteraction.zip'>Java</a> or
    <a href=
    'http://piccolo2d.googlecode.com/files/codesample.net-1.2-userinteraction.zip'>C#</a>.</p>

    <h2 id='step1'>1. Setup</h2>

    <p class='preamble'>We need to create a window with a Piccolo2D canvas, so that we can add the
    interface components to the canvas.</p>

    <ol>
      <li>
        <p>First you will need to reference the appropriate packages/namespaces.&nbsp; Add the
        following lines to the top of your code file:</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink1' class='toggle selected' id=
        'jlink1' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink1' id='clink1' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet1'>
          <pre class='snippet java' id='java1'>
import edu.umd.cs.piccolo.*;
import edu.umd.cs.piccolo.event.*;
import edu.umd.cs.piccolo.nodes.*;
import edu.umd.cs.piccolo.util.*;
import edu.umd.cs.piccolox.*;
</pre>
          <pre class='snippet csharp' id='csharp1'>
using UMD.HCIL.Piccolo;
using UMD.HCIL.Piccolo.Event;
using UMD.HCIL.Piccolo.Nodes;
using UMD.HCIL.Piccolo.Util;
using UMD.HCIL.PiccoloX;
</pre>
        </div>

        <p>The first line adds the base Piccolo2D types, such as <code>PNode</code>. The second line
        includes the basic event types. The third line includes the default node types that Piccolo2D
        provides, all of which extend <code>PNode</code>.&nbsp; The fourth line includes several utility
        classes, and the last line includes various "extras," such as <code>PForm</code> in .NET and
        <code>PFrame</code> in Java, which will be used below.</p>
      </li>

      <li>
        <p>Next we will extend the <code>PForm</code> class in .NET or the <code>PFrame</code>
        class in Java. This is a convenience class that adds a <code>PCanvas</code> to a window.
        When you extend this class, you should NOT add your Piccolo2D code to the constructor.
        Instead, you should override the <code>initialize</code> method and add all of your
        Piccolo2D code there.&nbsp; See the <a href='dev-faq.html'>FAQ</a> for more details.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink2' class='toggle selected' id=
        'jlink2' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink2' id='clink2' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet2'>
          <pre class='snippet java' id='java2'>
public class InteractionFrame extends PFrame {
        public void initialize() {
                //Add Piccolo2D code here.
        }
}
</pre>
          <pre class='snippet csharp' id='csharp2'>
public class InteractionForm : PForm {
        public override void Initialize() {
                //Add Piccolo2D code here.
        }
}
</pre>
        </div>
      </li>
    </ol>

    <h2 id='step2'>2. Create a Camera Event Listener</h2>

    <p class='preamble'>Event listeners can be attached to any node in the hierarchy.&nbsp; The
    events that you get depend on the node that you have registered with.&nbsp; For example you
    will only get mouse moved events when the mouse is over the node that you have registered with,
    not when the mouse is over some other node.</p>

    <p class='preamble'>As explained in <a href='patterns.html'>Piccolo2D Patterns</a>, events are
    dispatched to the <code>PPickPath</code> associated with the appropriate focus node (MouseOver,
    MouseFocus or KeyboardFocus).&nbsp; They percolate up the pick path, giving each node along the
    way a chance to handle the event if that node has a registered event handler.&nbsp;&nbsp; The
    events will keep percolating up the pick path until they are consumed by a node's event handler
    or they reach the originating camera node.&nbsp; Often you will attach event handlers directly
    to the main camera, in order to receive all events that come from the canvas.</p>

    <p class='preamble'>Piccolo2D comes with event listeners that let the user zoom and pan the
    viewpoint and drag nodes in the interface.&nbsp; You can use the default event listeners
    directly or you can define your own.&nbsp; Here, we will create a new kind of event listener
    and add it to the camera.</p>

    <ol>
      <li>
        <p>We will create a squiggle event handler, that draws squiggles as the mouse is dragged
        along the canvas.&nbsp; To do this, we will extend PBasicInputEventHandler, the standard
        class in Piccolo2D that is used to register for mouse and keyboard events on a PNode.&nbsp;
        Add the following internal class beneath the <code>initialize</code> method.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink3' class='toggle selected' id=
        'jlink3' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink3' id='clink3' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet3'>
          <pre class='snippet java' id='java3'>
public class SquiggleHandler extends PBasicInputEventHandler {
        protected PCanvas canvas;
                
        // The squiggle that is currently getting created.
        protected PPath squiggle;

        public SquiggleHandler(PCanvas aCanvas) {
                canvas = aCanvas;
                setEventFilter(new PInputEventFilter(InputEvent.BUTTON1_MASK));
        }
                
        public void mousePressed(PInputEvent e) {
                super.mousePressed(e);

                Point2D p = e.getPosition();

                // Create a new squiggle and add it to the canvas.
                squiggle = new PPath();
                squiggle.moveTo((float) p.getX(), (float) p.getY());
                squiggle.setStroke(new BasicStroke(
                        (float) (1 / e.getCamera().getViewScale())));
                canvas.getLayer().addChild(0, squiggle);
                        
                // Reset the keydboard focus.
                e.getInputManager().setKeyboardFocus(null);
        }

        public void mouseDragged(PInputEvent e) {
                super.mouseDragged(e);

                // Update the squiggle while dragging.
                updateSquiggle(e);
        }

        public void mouseReleased(PInputEvent e) {
                super.mouseReleased(e);

                // Update the squiggle one last time.
                updateSquiggle(e);
                squiggle = null;
        }

        public void updateSquiggle(PInputEvent aEvent) {
                // Add a new segment to the squiggle
                // from the last mouse position to
                // the current mouse position.
                Point2D p = aEvent.getPosition();
                squiggle.lineTo((float) p.getX(), (float) p.getY());
        }
}
</pre>
          <pre class='snippet csharp' id='csharp3'>
class SquiggleHandler : PBasicInputEventHandler {
        protected PCanvas canvas;

        // The squiggle that is currently getting created.
        protected PPath squiggle;

        // The last mouse position.
        protected PointF lastPoint;

        public SquiggleHandler(PCanvas canvas) {
                this.canvas = canvas;
        }

        public override void OnMouseDown(object sender, PInputEventArgs e) {
                base.OnMouseDown (sender, e);

                // Create a new squiggle and add it to the canvas.
                squiggle = new PPath();
                squiggle.Pen = new Pen(Brushes.Black,
                        (float)(1/ e.Camera.ViewScale));
                canvas.Layer.AddChild(0, squiggle);

                // Save the current mouse position.             
                lastPoint = e.Position;
                
                // Reset the keyboard focus.
                e.InputManager.KeyboardFocus = null;
        }

        public override void OnMouseDrag(object sender, PInputEventArgs e) {
                base.OnMouseDrag (sender, e);

                // Update the squiggle while dragging.
                UpdateSquiggle(e);
        }

        public override void OnMouseUp(object sender, PInputEventArgs e) {
                base.OnMouseUp (sender, e);

                // Update the squiggle one last time.
                UpdateSquiggle(e);
                squiggle = null;
        }

        protected void UpdateSquiggle(PInputEventArgs e) {
                // Add a new segment to the squiggle
                // from the last mouse position to
                // the current mouse position.
                PointF p = e.Position;
                if (p.X != lastPoint.X || p.Y != lastPoint.Y) {
                        squiggle.AddLine(lastPoint.X, lastPoint.Y, p.X, p.Y);
                }
                lastPoint = p;
        }

        public override bool DoesAcceptEvent(PInputEventArgs e) {
                // Filter out everything but left mouse button events.
                return (base.DoesAcceptEvent(e)
                        &amp;&amp; e.IsMouseEvent &amp;&amp; e.Button == MouseButtons.Left);
        }
}
</pre>
        </div>

        <p><code>PBasicInputEventHandler</code> is the top-level event handler class.&nbsp; It
        implements the <code>PInputEventListener</code> interface.&nbsp; All event listeners must
        implement this interface.&nbsp; Typically, you will not implement it directly.&nbsp;
        Instead, you will usually create event handlers by extending the existing event handler
        classes.&nbsp; <code>PBasicInputEventListener</code> provides empty methods for all of the
        basic input event types.&nbsp; You simply override the methods for the events you are
        interested in handling.&nbsp; In the above example we override the appropriate methods for
        handling mouse pressed, dragged and released events.</p>

        <p>When the mouse is pressed, we create a new <code>PPath</code> called squiggle and add it
        to the canvas's main layer.&nbsp; Notice that we set the path's pen width to 1 / ViewScale,
        so that we will always draw with a uniform width.&nbsp; We also save the current mouse
        position as the <code>lastPoint</code>.</p>

        <p>When the mouse is dragged, we call <code>UpdateSquiggle()</code>.&nbsp; This method will
        add a new line segment from the <code>lastPoint</code> to the current mouse position.&nbsp;
        Finally it will set the <code>lastPoint</code> to be the current mouse position.</p>

        <p>When the mouse is released, we will call updateSquiggle one more time and then set our
        current squiggle to null.</p>

        <p>Finally, you might notice that the C# version of this code snippet, overrides the
        DoesAcceptEvent method.&nbsp; This method is part of the PInputEventListener interface and
        is used to implement event filtering in Piccolo2D.NET.&nbsp; Any event handler class can
        override this method and return true if it wants to accept an event, or false
        otherwise.&nbsp; Filtered events will never be dispatched to the event handler.&nbsp; In
        this case, we only accept left mouse button events, so that the right mouse button cannot
        be used to draw squiggles.</p>
      </li>

      <li>
        <p>Now that we have created our squiggle event handler, we need to register it with a node
        so that it can receive events.&nbsp; We will add the squiggle event handler to the main
        camera node.&nbsp; Add the following lines of code to the <code>initialize</code>
        method.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink4' class='toggle selected' id=
        'jlink4' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink4' id='clink4' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet4'>
          <pre class='snippet java' id='java4'>
// Remove the pan event handler that is installed by default so that it
// does not conflict with our new squiggle handler.
getCanvas().setPanEventHandler(null);

// Create a squiggle handler and register it with the Canvas.
PBasicInputEventHandler squiggleHandler = new SquiggleHandler(getCanvas());
getCanvas().addInputEventListener(squiggleHandler);
</pre>
          <pre class='snippet csharp' id='csharp4'>
// Remove the pan event handler that is installed by default so that it
// does not conflict with our new squiggle handler.
Canvas.PanEventHandler = null;

// Create a squiggle handler and register it with the Canvas.
PBasicInputEventHandler squiggleHandler = new SquiggleHandler(Canvas);          
Canvas.AddInputEventListener(squiggleHandler);
</pre>
        </div>

        <p>First we remove the default pan event handler because we don't want it to conflict with
        our squiggle event handler.&nbsp; Since we are not using our right mouse button, we do not
        have to remove the default zoom event handler.</p>

        <p>Next we create our squiggle event handler.&nbsp; Notice that the Java version of this
        code snippet calls the <code>setEventFilter()</code> method and passes it a new instance of
        <code>PInputEventFilter</code>.&nbsp; In Piccolo2D.Java, event filtering is accomplished by
        creating a new event filter object and setting various masks on that object.&nbsp; In
        particular, an event will be accepted if it contains all the modifiers listed in the
        <code>andMask</code>, at least one of the modifiers listed in the <code>orMask</code>, and
        none of the modifiers listed in the <code>notMask</code>.&nbsp; In this case, we set the
        <code>andMask</code> to a <code>BUTTON1_MASK</code>, so that it will only accept left mouse
        button events.</p>

        <p>Finally, we register our new squiggle event handler to receive events from the
        camera.&nbsp; Notice that we do this by calling the canvas's
        <code>AddInputEventListener()</code> method.&nbsp; This is just a convenience method that
        adds the given event listener to the main camera associated with the canvas.&nbsp; We could
        have also gotten the camera from the canvas and added the event listener directly.</p>
      </li>
    </ol>

    <h2 id='step5'>3. Create a Node Event Listener</h2>

    <p class='preamble'>Now that we have added an event handler to the camera, lets try adding an
    event handler to another node.&nbsp;</p>

    <ol>
      <li>
        <p>First, we will create green rectangle node and add it to the main layer.&nbsp; Add the
        following lines of code to the <code>initialize</code> method.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink5' class='toggle selected' id=
        'jlink5' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink5' id='clink5' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet5'>
          <pre class='snippet java' id='java5'>
// Create a green rectangle node.
PNode nodeGreen = PPath.createRectangle(0, 0, 100, 100);
nodeGreen.setPaint(Color.GREEN);
getCanvas().getLayer().addChild(nodeGreen);
</pre>
          <pre class='snippet csharp' id='csharp5'>
// Create a green rectangle node.
PNode nodeGreen = PPath.CreateRectangle(0, 0, 100, 100);
nodeGreen.Brush = Brushes.Green;
Canvas.Layer.AddChild(nodeGreen);
</pre>
        </div>
      </li>

      <li>
        <p>Next, we will create a new event handler that will change our node's color to orange
        when the mouse is pressed over the node and back to green, when it is released.&nbsp;
        Additionally, the event handler will move the node when the mouse is dragged.&nbsp; We will
        be careful to consume these events, since we don't want dragging the node around to draw
        squiggles underneath of it.&nbsp; Note, this is a simple example, but most of the time the
        best way to implement dragging is to use a PDragEventHandler.&nbsp; Add the following lines
        of code to the project.&nbsp; The java snippet should be added directly to the
        <code>initialize</code> method.&nbsp; The .NET snippet should be added beneath
        <code>initialize</code>.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink6' class='toggle selected' id=
        'jlink6' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink6' id='clink6' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet6'>
          <pre class='snippet java' id='java6'>
// Attach event handler directly to the node.
nodeGreen.addInputEventListener(new PBasicInputEventHandler() {
        public void mousePressed(PInputEvent event) {
                event.getPickedNode().setPaint(Color.ORANGE);
                event.getInputManager().setKeyboardFocus(event.getPath());
                event.setHandled(true);
        }
        public void mouseDragged(PInputEvent event) {
                PNode aNode = event.getPickedNode();
                PDimension delta = event.getDeltaRelativeTo(aNode);
                aNode.translate(delta.width, delta.height);
                event.setHandled(true);
        }
        public void mouseReleased(PInputEvent event) {
                event.getPickedNode().setPaint(Color.GREEN);
                event.setHandled(true);
        }
        public void keyPressed(PInputEvent event) {
                PNode node = event.getPickedNode();
                switch (event.getKeyCode()) {
                        case KeyEvent.VK_UP:
                                node.translate(0, -10f);
                                break;
                        case KeyEvent.VK_DOWN:
                                node.translate(0, 10f);
                                break;
                        case KeyEvent.VK_LEFT:
                                node.translate(-10f, 0);
                                break;
                        case KeyEvent.VK_RIGHT:
                                node.translate(10f, 0);
                                break;
                }
        }
});
</pre>
          <pre class='snippet csharp' id='csharp6'>
protected void nodeGreen_MouseDown(object sender, PInputEventArgs e) {
        PNode aNode = (PNode)sender;
        aNode.Brush = new SolidBrush(Color.Orange);
        e.InputManager.KeyboardFocus = e.Path;
        e.Handled = true;
}

protected void nodeGreen_MouseDrag(object sender, PInputEventArgs e) {
        PNode aNode = (PNode)sender;
        SizeF delta = e.GetDeltaRelativeTo(aNode);
        aNode.TranslateBy(delta.Width, delta.Height);
        e.Handled = true;
}

protected void nodeGreen_MouseUp(object sender, PInputEventArgs e) {
        PNode aNode = (PNode)sender;
        aNode.Brush = new SolidBrush(Color.Green);
        e.Handled = true;
}

protected void nodeGreen_KeyDown(object sender, PInputEventArgs e) {
        PNode node = (PNode)sender;
        switch (e.KeyCode) {
                case Keys.Up:
                        node.TranslateBy(0, -10);
                        break;
                case Keys.Down:
                        node.TranslateBy(0, 10);
                        break;
                case Keys.Left:
                        node.TranslateBy(-10, 0);
                        break;
                case Keys.Right:
                        node.TranslateBy(10, 0);
                        break;
        }
}
</pre>
        </div>

        <p>The first thing you might notice is that the C# version of this code snippet does not
        extend <code>PBasicInputEventHandler</code>.&nbsp; Instead, it consists of several distinct
        methods.&nbsp; In Piccolo2D.NET there are actually two ways to create event handlers.&nbsp;
        The first is to use the standard approach of extending the event handler classes.&nbsp;
        But, you can also add event handler methods directly to a node, in the same way that you
        can add event handler methods directly to Control.&nbsp; PNode defines Events for each of
        the basic input events.&nbsp; The benefit of doing things this way is that it takes fewer
        lines of code.&nbsp; The benefit of using classes is that your event handlers will be
        reusable and capable of maintaining state.</p>

        <p>When the mouse is pressed, we get the pressed node and set it's fill color to be
        orange.&nbsp; Next, we get the InputManager from the event and set it's keyboard focus node
        to be the current pick path generated from this mouse pressed event.&nbsp; This ensures
        that all future keyboard events will be dispatched to that pick path.&nbsp; Otherwise, our
        key pressed event handler would never get called.&nbsp; For more information about focus
        nodes, picking and event dispatch, see <a href='patterns.html'>Piccolo2D
        Patterns</a>.&nbsp; Finally, we consume the event by marking it as handled.&nbsp; If we did
        not do this, the event would percolate up to the camera and get dispatched to our squiggle
        event handler.</p>

        <p>When the mouse is dragged, we get the distance that the mouse has moved from it's last
        position and we translate the node by that amount.&nbsp; This is how dragging is
        implemented.&nbsp; Notice that we get the distance by calling
        <code>GetDeltaRelativeToNode</code>, ensuring that the value returned is in the local
        coordinate system of this node.&nbsp; We also mark this event as handled.</p>

        <p>When the mouse is released, we set the node's fill back to green and mark the event as
        handled.</p>

        <p>When an arrow key is pressed, we will translate the node by 10 in the direction of the
        arrow.&nbsp; Note the key pressed event handler will only get called when our node has the
        keyboard focus.&nbsp; So, once we click on the node, we will be able to move it with the
        arrow keys .&nbsp; But, after we draw a squiggle, the arrow keys will no longer move the
        node, since the squiggle event handler resets the keyboard focus to null.&nbsp; We would
        then have to click on the node again to give it back the keyboard focus.</p>
      </li>

      <li>
        <p>Finally, we will register the node event handler with our node.&nbsp; Add the following
        lines of code to the <code>initialize</code> method.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink7' class='toggle selected' id=
        'jlink7' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink7' id='clink7' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet7'>
          <pre class='snippet java' id='java7'>
// Attach event handler directly to the node.

The Java version defines and attaches the event handler using an anonymous
class. See previous code sample.
</pre>
          <pre class='snippet csharp' id='csharp7'>
// Attach event delegates directly to the node.
nodeGreen.MouseDown += new PInputEventHandler(nodeGreen_MouseDown);
nodeGreen.MouseDrag += new PInputEventHandler(nodeGreen_MouseDrag);
nodeGreen.MouseUp += new PInputEventHandler(nodeGreen_MouseUp);
nodeGreen.KeyDown += new PInputEventHandler(nodeGreen_KeyDown);
</pre>
        </div>

        <p>Notice that the C# version of this code snippet adds each of the event handler methods
        individually, using the <code>PInputEventHandler</code> delegate.&nbsp; We could have also
        extended <code>PBasicInputEventHandler</code> and added a new event handler class to the
        node, as the Java code does.</p>
      </li>
    </ol>
  </div><script src='snippets.js' type='text/javascript'>
//<![CDATA[
    //]]>
  </script><script src='../scrollsidebar.js' type='text/javascript'>
//<![CDATA[
    //]]>
  </script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <meta name='generator' content=
  'HTML Tidy for Linux/x86 (vers 7 December 2008), see www.w3.org' />
  <meta content='text/html; charset=us-ascii' http-equiv='Content-Type' />
  <meta name='description' content='Home Page for the Piccolo2D project.' />
  <meta name='format' content='text/html' />
  <meta name='keywords' content=
  'piccolo2d, piccolo2d.net, piccolo, piccolo.net, zoomable, zui, user interfaces, human-computer interaction, HCI, visualization, education' />
  <meta name='relation' content='(contained in)=http://www.piccolo2d.org' />

  <title>Piccolo2D.Java - Graph Editor</title>
  <link href='../piccolo2d.css' rel='stylesheet' type='text/css' />
</head>

<body>
  <div id='navigation'>
    <!-- 
this navigation node is auto-generated and injected
by the script tools/inject_navigation.rb

DO NOT EDIT IT MANUALLY!!!      
-->

    <p class='header'><a href='../index.html'><img src='../images/Piccolo2D-Logo-small.png' alt=
    'Piccolo2D Logo' /></a></p>

    <ul>
      <li>
        <a href='../index.html'>Piccolo2D&nbsp;Home</a>

        <ul>
          <li><a href='../play/index.html'>Play</a></li>

          <li>
            <a href='../learn/index.html'>Learn</a>

            <ul>
              <li><a href='../learn/about.html'>About&nbsp;Piccolo2D</a></li>

              <li><a href='../learn/patterns.html'>Piccolo2D&nbsp;Patterns</a></li>

              <li>
                <a href='../learn/get-started.html'>Getting&nbsp;Started</a>

                <ul>
                  <li><a href=
                  '../learn/out-of-box-java.html'>Java:&nbsp;Out&nbsp;of&nbsp;the&nbsp;Box</a></li>

                  <li><a href=
                  '../learn/out-of-box-dotnet.html'>.Net:&nbsp;Out&nbsp;of&nbsp;the&nbsp;Box</a></li>

                  <li><a href='../learn/interface.html'>The&nbsp;Interface</a></li>

                  <li><a href='../learn/interaction.html'>User&nbsp;Interaction</a></li>

                  <li><a href='../learn/effects.html'>Special&nbsp;Effects</a></li>

                  <li><a href='../learn/fisheye.html'>Fisheye&nbsp;Calendar</a></li>

                  <li><a href='../learn/grapheditor.html' class=
                  'selected'>Graph&nbsp;Editor</a></li>
                </ul>
              </li>

              <li><a href='../learn/api.html'>API&nbsp;Documentation</a></li>

              <li><a href='../learn/comparison.html'>Piccolo2D&nbsp;in&nbsp;Comparison</a></li>

              <li><a href='../learn/publications.html'>Publications</a></li>

              <li><a href='../learn/dev-faq.html'>Developer&nbsp;FAQ</a></li>

              <li><a href='../learn/graphics.html'>Graphics&nbsp;Primer</a></li>
            </ul>
          </li>

          <li><a href='../download.html'>Download</a></li>

          <li><a href='../community.html'>Community</a></li>

          <li><a href='../applications/index.html'>Applications</a></li>

          <li><a href='../press.html'>Press</a></li>

          <li><a href='../sponsors.html'>Sponsors</a></li>
        </ul>
      </li>
    </ul><!--
<p>
        <img src='../images/giny-small.png' alt='a nice graph' />
</p>
-->

    <p class='bugreport'><a href=
    'http://code.google.com/p/piccolo2d/issues/entry?template=User%20defect%20report'>Found a
    Typo?</a></p>

    <p class='validators'><a href='http://validator.w3.org/check/referer'><img src=
    'http://www.w3.org/Icons/valid-xhtml10-blue' alt='Valid XHTML 1.0!' style=
    'border:0;width:88px;height:31px' /></a> <a href=
    'http://jigsaw.w3.org/css-validator/check/referer'><img src=
    'http://www.w3.org/Icons/valid-css-blue' alt='Valid CSS1!' style=
    'border:0;width:88px;height:31px' /></a></p>
  </div>

  <div id='main'>
    <div id='main-head'>
      <h1>Getting Started</h1>Here you will find both basic and advanced tutorials to help you get
      started using Piccolo2D.&nbsp; All tutorials provide examples in both Java and C#.&nbsp; This
      section assumes you have read <a href='patterns.html'>Piccolo2D Patterns</a> and have a basic
      understanding of the concepts presented there.
    </div>

    <p class='toggle' id='language' style=
    'float: right; width: 8.5em; height: 8ex; border:thin solid blue;'>Show examples in<br />
    <img src='images/check.png' id='java0' alt='Checkmark' style=
    'border:0;width:1.0em;height:2ex' /> <a href='javascript:void(0);' name='jlink0' class=
    'toggle selected' id='jlink0' onmousedown=
    'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a><br />

    <img src='images/check.png' id='csharp0' alt='Checkmark' style=
    'visibility: hidden;border:0;width:1.0em;height:2ex' /> <a href='javascript:void(0);' name=
    'clink0' id='clink0' onmousedown=
    'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

    <h1>Graph Editor</h1>

    <p class='preamble'>This tutorial will illustrate how you might build a graph editor interface
    using Piccolo2D.&nbsp; Moving the mouse over a node will highlight that node.&nbsp; And,
    dragging a node will move that node around, keeping the edges connected.</p>

    <p class='image'><img src='images/grapheditor.jpg' alt='graph editor' /><br />
    Download the complete code sample in <a href=
    'http://piccolo2d.googlecode.com/files/codesample.java-1.2-grapheditor.zip'>Java</a> or
    <a href='http://piccolo2d.googlecode.com/files/codesample.net-1.2-grapheditor.zip'>C#</a>.<br />

    <a href='../play/applet/grapheditor.html'>Play</a> with the interface.</p>

    <h2>Overall Architecture</h2>

    <p>In this example, we will use the <code>PPath</code> node provided by Piccolo2D for both our
    nodes and edges.&nbsp; Rather than creating our own data structure to keep track of the
    connections, we will use <code>PNode</code>'s <code>Tag</code> property in .NET and its
    <code>getAttribute</code> and <code>addAttribute</code> methods in Java.&nbsp; Both of these
    mechanisms provide the ability to attach extra information to a node without subclassing
    it.&nbsp; For each node in the graph, we will attach a list of its connected edges.&nbsp; And
    for each edge in the graph, we will attach a list of its connected nodes.</p>

    <p>We will then create a reusable GraphEditor component that extends PCanvas. This component
    will add the nodes and edges to the scene-graph.&nbsp; We will also create an event handler
    class to drag the nodes and update the edges.&nbsp; Finally, we will create a wrapper window
    called GraphEditorTester and add our new component to the window.</p>

    <h2 id='step1'>1. Create a Graph Canvas</h2>

    <p class='preamble'>We will make a reusable component that extends PCanvas and initializes the
    graph.</p>

    <ol>
      <li>
        <p>We extend PCanvas and add some random nodes and edges.&nbsp; Add the following class to
        your project.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink1' class='toggle selected' id=
        'jlink1' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink1' id='clink1' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet1'>
          <pre class='snippet java' id='java1'>
public class GraphEditor extends PCanvas {
    public GraphEditor(int width, int height) {
        setPreferredSize(new Dimension(width, height));
        int numNodes = 50;
        int numEdges = 50;

        // Initialize, and create a layer for the edges
        // (always underneath the nodes)
        PLayer nodeLayer = getLayer();
        PLayer edgeLayer = new PLayer();
        getRoot().addChild(edgeLayer);
        getCamera().addLayer(0, edgeLayer);
        Random random = new Random();

        // Create some random nodes
        // Each node's attribute set has an
        // ArrayList to store associated edges
        for (int i = 0; i &lt; numNodes; i++) {
            float x = random.nextInt(width);
            float y = random.nextInt(height);
            PPath node = PPath.createEllipse(x, y, 20, 20);
            node.addAttribute("edges", new ArrayList());
            nodeLayer.addChild(node);
        }
        
        // Create some random edges
        // Each edge's attribute set has an
        // ArrayList to store associated nodes
        for (int i = 0; i &lt; numEdges; i++) {
            int n1 = random.nextInt(numNodes);
            int n2 = random.nextInt(numNodes);

            // Make sure we have two distinct nodes.
            while (n1 == n2) {
                n2 = random.nextInt(numNodes);
            }
            
            PNode node1 = nodeLayer.getChild(n1);
            PNode node2 = nodeLayer.getChild(n2);
            PPath edge = new PPath();
            ((ArrayList)node1.getAttribute("edges")).add(edge);
            ((ArrayList)node2.getAttribute("edges")).add(edge);
            edge.addAttribute("nodes", new ArrayList());
            ((ArrayList)edge.getAttribute("nodes")).add(node1);
            ((ArrayList)edge.getAttribute("nodes")).add(node2);
            edgeLayer.addChild(edge);
            updateEdge(edge);
        }
        
        // Create event handler to move nodes and update edges
        nodeLayer.addInputEventListener(...);
    }
    
    public void updateEdge(PPath edge) {
        // Note that the node's "FullBounds" must be used
        // (instead of just the "Bounds") because the nodes
        // have non-identity transforms which must be included
        // when determining their position.


        PNode node1 = (PNode) ((ArrayList)edge.getAttribute("nodes")).get(0);
        PNode node2 = (PNode) ((ArrayList)edge.getAttribute("nodes")).get(1);
        Point2D start = node1.getFullBoundsReference().getCenter2D();
        Point2D end = node2.getFullBoundsReference().getCenter2D();
        edge.reset();
        edge.moveTo((float)start.getX(), (float)start.getY());
        edge.lineTo((float)end.getX(), (float)end.getY());
    }
}
</pre>
          <pre class='snippet csharp' id='csharp1'>
public class GraphEditor : PCanvas {
    public GraphEditor(int width, int height) {
        this.Size = new Size(width, height);
        int numNodes = 50;
        int numEdges = 50;

        // Initialize, and create a layer for the edges
        // (always underneath the nodes)
        PLayer nodeLayer = this.Layer;
        PLayer edgeLayer = new PLayer();
        Root.AddChild(edgeLayer);
        this.Camera.AddLayer(0, edgeLayer);
        Random rnd = new Random();

        // Create some random nodes
        // Each node's Tag has an ArrayList
        // used to store associated edges
        for (int i=0; i&lt;numNodes; i++) {
            float x = (float)(this.ClientSize.Width * rnd.NextDouble());
            float y = (float)(this.ClientSize.Height * rnd.NextDouble());
            PPath path = PPath.CreateEllipse(x, y, 20, 20);
            path.Tag = new ArrayList();
            nodeLayer.AddChild(path);
        }

        // Create some random edges
        // Each edge's Tag has an ArrayList
        // used to store associated nodes
        for (int i=0; i&lt;numEdges; i++) {
            int n1 = rnd.Next(numNodes);
            int n2 = n1;

            // Make sure we have two distinct nodes.
            while (n2 == n1) {
                n2 = rnd.Next(numNodes);
            }

            PNode node1 = nodeLayer[n1];
            PNode node2 = nodeLayer[n2];
            PPath edge = new PPath();
            ((ArrayList)node1.Tag).Add(edge);
            ((ArrayList)node2.Tag).Add(edge);
            edge.Tag = new ArrayList();
            ((ArrayList)edge.Tag).Add(node1);
            ((ArrayList)edge.Tag).Add(node2);
            edgeLayer.AddChild(edge);
            UpdateEdge(edge);
        }

        // Create event handler to move nodes and update edges
        nodeLayer.AddInputEventListener(new NodeDragHandler());
    }

    public static void UpdateEdge(PPath edge) {
        // Note that the node's "FullBounds" must be used
        // (instead of just the "Bounds") because the nodes
        // have non-identity transforms which must be included
        // when determining their position.

        ArrayList nodes = (ArrayList)edge.Tag;
        PNode node1 = (PNode)nodes[0];
        PNode node2 = (PNode)nodes[1];
        PointF start = PUtil.CenterOfRectangle(node1.FullBounds);
        PointF end = PUtil.CenterOfRectangle(node2.FullBounds);
        edge.Reset();
        edge.AddLine(start.X, start.Y, end.X, end.Y);
    }
}

</pre>
        </div>

        <p>First we create some randomly positioned ellipses, for our nodes.&nbsp; Next, we need to
        attach a list to each node, to store the connected edges.&nbsp; <em>Piccolo2D.NET</em>
        provides the ability to add an object reference as a tag whereas <em>Piccolo2D.Java</em>
        uses a set of named attributes instead.&nbsp; In the Java version, we use
        <code>addAttribute</code> to attach an ArrayList.&nbsp; In the .NET version, we set each
        node's <code>Tag</code> property to an ArrayList.</p>

        <p>Next, we create some lines for our edges. Note, we use a separate layer added underneath
        the main layer, to insure that the nodes are always on top.&nbsp; For each edge, we
        randomly choose two nodes to connect.&nbsp; We add the edge to each node's list of edges
        and we add the nodes to the edge's list of nodes.&nbsp; The <code>UpdateEdge</code> method
        is called to position the line's endpoints to the center points of each node.</p>

        <p>Finally, we add an event listener, defined below, to make our graph interactive.</p>
      </li>
    </ol>

    <h2 id='step2'>2. Create a Drag Event Handler</h2>

    <p class='preamble'>We will create an event listener class to handle all of the interaction of
    our application, including highlighting and dragging nodes.</p>

    <ol>
      <li>
        <p>We extend <code>PDragSequenceEventHandler</code> to create an event listener that
        performs some operation during a drag sequence.&nbsp; Add the following code to your
        project.&nbsp; For the Java version, you should add the anonymous event listener class to
        the constructor.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink2' class='toggle selected' id=
        'jlink2' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink2' id='clink2' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet2'>
          <pre class='snippet java' id='java2'>
nodeLayer.addInputEventListener(new PDragEventHandler() {
    {
        PInputEventFilter filter = new PInputEventFilter();
        filter.setOrMask(InputEvent.BUTTON1_MASK | InputEvent.BUTTON3_MASK);
        setEventFilter(filter);
    }

    public void mouseEntered(PInputEvent e) {
        super.mouseEntered(e);
        if (e.getButton() == MouseEvent.NOBUTTON) {
            e.getPickedNode().setPaint(Color.RED);
        }
    }
    
    public void mouseExited(PInputEvent e) {
        super.mouseExited(e);
        if (e.getButton() == MouseEvent.NOBUTTON) {
            e.getPickedNode().setPaint(Color.WHITE);
        }
    }
    
    protected void startDrag(PInputEvent e) {
        super.startDrag(e);
        e.setHandled(true);
        e.getPickedNode().moveToFront();
    }
    
    protected void drag(PInputEvent e) {
        super.drag(e);
        
        ArrayList edges = (ArrayList) e.getPickedNode().getAttribute("edges");
        for (int i = 0; i &lt; edges.size(); i++) {
            GraphEditor.this.updateEdge((PPath) edges.get(i));
        }
    }
});
</pre>
          <pre class='snippet csharp' id='csharp2'>
class NodeDragHandler : PDragEventHandler {
    public override bool DoesAcceptEvent(PInputEventArgs e) {
        return e.IsMouseEvent &amp;&amp;
            (e.Button != MouseButtons.None || e.IsMouseEnterOrMouseLeave);
    }

    public override void OnMouseEnter(object sender, PInputEventArgs e) {
        base.OnMouseEnter (sender, e);
        if (e.Button == MouseButtons.None) {
            e.PickedNode.Brush = Brushes.Red;
        }
    }

    public override void OnMouseLeave(object sender, PInputEventArgs e) {
        base.OnMouseLeave (sender, e);
        if (e.Button == MouseButtons.None) {
            e.PickedNode.Brush = Brushes.White;
        }
    }

    protected override void OnStartDrag(object sender, PInputEventArgs e) {
        base.OnStartDrag(sender, e);
        e.Handled = true;
        e.PickedNode.MoveToFront();
    }

    protected override void OnDrag(object sender, PInputEventArgs e) {
        base.OnDrag (sender, e);

        ArrayList edges = (ArrayList)e.PickedNode.Tag;
        foreach (PPath edge in edges) {
            GraphEditor.UpdateEdge(edge);
        }
    }
}

</pre>
        </div>

        <p>When the mouse enters a node, we set the node's fill color to red to highlight the
        node.&nbsp; When the mouse leaves a node, we set it's fill color back to white.&nbsp; We
        only do this when no mouse buttons are pressed because we don't want to highlight a node
        when the mouse is dragged overtop of it.&nbsp; And, we consume the drag event, so that we
        will not pan when a node is dragged.</p>

        <p>We also need to update the edges.&nbsp; During a drag sequence, we iterate over the
        dragged node's edges and call <code>UpdateEdge</code> on each one.&nbsp; Recall this method
        gets the two nodes each edge connects, and then repositions the edge to the center points
        of each connected node.</p>
      </li>
    </ol>

    <h2 id='step3'>3. Add the Canvas to a Window</h2>

    <p class='preamble'>Now we are ready to add our new component to the window.</p>

    <ol>
      <li>
        <p>We create a <code>JFrame</code> in Java or a <code>Form</code> in .NET as a wrapper for
        our component. Add the following class to your project.</p>

        <p class='toggle'><a href='javascript:void(0);' name='jlink3' class='toggle selected' id=
        'jlink3' onmousedown=
        'swapSections(&#39;csharp&#39;, &#39;java&#39;, &#39;clink&#39;, &#39;jlink&#39;);'>Java</a>
        | <a href='javascript:void(0);' name='clink3' id='clink3' onmousedown=
        'swapSections(&#39;java&#39;, &#39;csharp&#39;, &#39;jlink&#39;, &#39;clink&#39;);'>C#</a></p>

        <div class='snippet' id='snippet3'>
          <pre class='snippet java' id='java3'>
public class GraphEditorTester extends JFrame {
    public GraphEditorTester() {
        setTitle("Piccolo2D Graph Editor");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        GraphEditor graphEditor = new GraphEditor(500, 500);
        getContentPane().add(graphEditor);
        pack();
        setVisible(true);
    }

    public static void main(String args[]) {
        new GraphEditorTester();
    }
}
</pre>
          <pre class='snippet csharp' id='csharp3'>
public class GraphEditorTester : System.Windows.Forms.Form {
    public GraphEditorTester() {
        GraphEditor graphEditor = new GraphEditor(this.ClientSize.Width,
            this.ClientSize.Height);
        Controls.Add(graphEditor);
        graphEditor.Bounds = this.ClientRectangle;
        graphEditor.Anchor = graphEditor.Anchor |
            AnchorStyles.Right | AnchorStyles.Bottom;
    }

    static void Main() {
        Application.Run(new GraphEditorTester());
    }
}
</pre>
        </div>

        <p>First, we create an instance of our GraphEditor component and add it to the form's list
        of controls.&nbsp; Then, we anchor or new component to the sides of the window, so that it
        will get resized when the window is resized.</p>
      </li>
    </ol>
  </div><script src='snippets.js' type='text/javascript'>
//<![CDATA[
    //]]>
  </script><script src='../scrollsidebar.js' type='text/javascript'>
//<![CDATA[
    //]]>
  </script>
</body>
</html>
